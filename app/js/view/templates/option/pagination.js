!function(t,a){"use strict";function e(e){this.el=a.createElement("div"),this.el.className="pagination",this.blockEl=e.blockEl,this.collection=e.collection,this.container=t.serviceContainer,this.pagination=t.pagination,this.behaviourPagination=this.pagination.type,this.event=t.Lib.Event,this.count=0,this.pages=[],"lazyLoad"==this.behaviourPagination?this.lazyInit():this.paginationInit(),t.serviceContainer.template.pagination=this}e.prototype.lazyInit=function(){var t=this,a=this.container.template.userTable,e=this.container.template.userTableTbody;this.container.model.user.load({count:!0}).then(function(i){t.count=i.count,a.el.classList.add("lazyLoad"),e.el.addEventListener("scroll",t.lazyHandlerScroll.bind(t,e,t.count,t.loadData.bind(t)))})},e.prototype.lazyHandlerScroll=function(a,e,i,n){var r=n.target,o=a.el.scrollTop+a.el.clientHeight,s=a.el.scrollHeight;if(o==s){var c=r.childNodes.length,l=c+t.pagination.perPage;c<e&&this.container.model.user.load({start:c,limit:l}).then(i)}},e.prototype.paginationInit=function(){var t=this;this.currentPage=this.pagination.currentPage,this.calculateQuantityPages().then(function(a){t.drawPages(a.quantity),t.backlightPage(),t.el.addEventListener("click",t.changePage.bind(t,t,t.loadData.bind(t)))}),this.event.addListener("deleteRow",this.deleteRow.bind(this)),this.event.addListener("addRow",this.addRow.bind(this))},e.prototype.deleteRow=function(){var t=this;this.calculateQuantityPages().then(function(a){if(a.mod===!1){t.currentPage=1==t.currentPage?1:t.currentPage==a.quantity+1?a.quantity:t.currentPage,t.drawPages(a.quantity),t.backlightPage();var e=t.getStartAndLimitRecords();t.getData(e.start,e.limit,t.loadData.bind(t))}})},e.prototype.addRow=function(){var t=this;this.calculateQuantityPages().then(function(a){t.currentPage=a.quantity,t.drawPages(a.quantity),t.backlightPage();var e=t.getStartAndLimitRecords();t.getData(e.start,e.limit,t.loadData.bind(t))})},e.prototype.calculateQuantityPages=function(){var t=this;return this.container.model.user.load({count:!0}).then(function(a){var e={};return a.count%t.pagination.perPage===0?(e.quantity=a.count/t.pagination.perPage,e.mod=!1):(e.quantity=Math.ceil(a.count/t.pagination.perPage),e.mod=!0),e})},e.prototype.drawPages=function(t){var e=a.createDocumentFragment();if(this.pages.length!=t){this.pages=[],this.el.innerHTML="";for(var i=1;i<=t;i++){var n=a.createElement("div");n.textContent=i,n.dataset.page=i,n.className="page",this.pages.push(n),e.appendChild(n)}this.el.appendChild(e)}},e.prototype.backlightPage=function(){var t=this;this.pages.forEach(function(a){var e=a.dataset.page;a.classList.remove("active"),e==t.currentPage&&a.classList.add("active")})},e.prototype.changePage=function(t,a,e){var i=e.target;if(!i.classList.contains("page"))return!1;var n=i.dataset.page;if(n==this.currentPage)return!1;this.currentPage=n,t.backlightPage();var r=t.getStartAndLimitRecords();t.getData(r.start,r.limit,a)},e.prototype.getStartAndLimitRecords=function(){var t=1==this.currentPage?0:this.currentPage*this.pagination.perPage-this.pagination.perPage,a=t+this.pagination.perPage;return{start:t,limit:a}},e.prototype.getData=function(t,a,e){var i=this;this.container.model.user.load({start:t,limit:a}).then(function(t){e(t),i.container.template.userTableTbody.clearRows(t)})},e.prototype.loadData=function(t){var a=this.container.template.userTableTbody;t.length&&a.newRows(t)},e.prototype.render=function(){return this.el},t.View.Option.Pagination=e}(App,document);