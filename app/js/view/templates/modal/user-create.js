!function(e,t){"use strict";function a(a){var i=this;this.el=t.createElement("div"),this.el.className="modal-window modal-create",this.el.dataset.languageKey="create",this.modalEl=a.modalEl,this.collection=a.collection,this.container=e.serviceContainer,this.modalType="create",this.isShow=!1,this.dictionary=this.container.lib.dictionary,this.nodes={},this.renderOrder=["caption","avatar","name","email","birth","date","control"],this.fields={caption:function(){return i.nodes.caption=t.createElement("h3"),i.nodes.caption.className="caption",i.nodes.caption.dataset.languageKey="caption",i.nodes.caption.textContent=i.dictionary.t(["modal",i.modalType,"caption"]),i.nodes.caption},avatar:function(){i.nodes.avatar=t.createElement("div"),i.nodes.avatar.className="group avatar-group";var e=t.createElement("label");e.dataset.languageKey="avatar",e.textContent=i.dictionary.t(["modal",i.modalType,"avatar"]),e.className="avatar-label";var a=t.createElement("input");return a.setAttribute("type","file"),a.setAttribute("name","avatar"),a.addEventListener("change",i.imageUpload.bind(i,i)),a.className="file-input",i.inputs.avatar=a,i.nodes.avatar.appendChild(e),i.nodes.avatar.appendChild(a),i.nodes.avatar},name:function(){i.nodes.name=t.createElement("div"),i.nodes.name.className="group name-group";var e=t.createElement("label");e.dataset.languageKey="name",e.textContent=i.dictionary.t(["modal",i.modalType,"name"]),e.className="name-label";var a=t.createElement("input");return a.setAttribute("type","text"),a.setAttribute("name","name"),a.className="name-input",i.inputs.name=a,i.nodes.name.appendChild(e),i.nodes.name.appendChild(a),i.nodes.name},email:function(){i.nodes.email=t.createElement("div"),i.nodes.email.className="group email-group";var e=t.createElement("label");e.dataset.languageKey="email",e.textContent=i.dictionary.t(["modal",i.modalType,"email"]),e.className="email-label";var a=t.createElement("input");return a.setAttribute("type","text"),a.setAttribute("name","email"),a.className="email-input",i.inputs.email=a,i.nodes.email.appendChild(e),i.nodes.email.appendChild(a),i.nodes.email},birth:function(){i.nodes.birth=t.createElement("div"),i.nodes.birth.className="group date-group";var e=t.createElement("label");e.dataset.languageKey="birth",e.textContent=i.dictionary.t(["modal",i.modalType,"birth"]),e.className="date-label";var a=t.createElement("input");return a.setAttribute("type","date"),a.setAttribute("name","birth"),a.className="birth-input",i.inputs.birth=a,i.nodes.birth.appendChild(e),i.nodes.birth.appendChild(a),i.nodes.birth},date:function(){i.nodes.time=t.createElement("div"),i.nodes.time.className="group date-group";var e=t.createElement("label");e.dataset.languageKey="time",e.textContent=i.dictionary.t(["modal",i.modalType,"time"]),e.className="date-label";var a=t.createElement("input");a.setAttribute("type","date"),a.setAttribute("name","date"),a.className="date-input",i.inputs.date=a;var n=t.createElement("input");return n.setAttribute("type","time"),n.setAttribute("name","time"),n.className="time-input",i.inputs.time=n,i.nodes.time.appendChild(e),i.nodes.time.appendChild(a),i.nodes.time.appendChild(n),i.nodes.time},control:function(){i.nodes.control=t.createElement("div"),i.nodes.control.className="group control-group";var e=t.createElement("button");e.className="add-btn",e.dataset.languageKey="save",e.textContent=i.dictionary.t(["modal",i.modalType,"save"]);var a=t.createElement("button");return a.className="cancel-btn",a.dataset.languageKey="cancel",a.textContent=i.dictionary.t(["modal",i.modalType,"cancel"]),i.nodes.control.appendChild(e),i.nodes.control.appendChild(a),i.nodes.control}},this.inputs={},this.avatar=null,this.uploader=new e.Lib.ImageUploader,this.el.addEventListener("click",this.handlerControlBtn.bind(this,this)),e.serviceContainer.template.modalCreate=this}a.prototype.handlerControlBtn=function(e,t){var a=t.target;if("BUTTON"!=a.tagName)return!1;switch(a.className){case"cancel-btn":e.beforeHide("cancel");break;case"add-btn":e.chekForm()}},a.prototype.imageUpload=function(e,t){var a=t.target;a.classList.remove("error"),a.classList.remove("success"),this.uploader.read(a,this.onImageUploadSuccess.bind(e))},a.prototype.onImageUploadSuccess=function(e){this.avatar=e},a.prototype.chekForm=function(){var t=e.Lib.Validator,a={},i=!0;for(var n in this.inputs){var s,r=this.inputs[n],o=this.inputs[n].value;switch(r.classList.remove("success"),r.classList.remove("error"),n){case"id":continue;case"avatar":s=t.checkImage(r);break;case"name":s=t.checkName(o);break;case"email":s=t.checkEmail(o);break;case"birth":s=t.checkStartDate({date:o});break;case"date":a.date=o;break;case"time":a.time=o;break;default:console.warn("Unknown type of validator")}if(r.classList.add(s.className),i=s.valid,!i)break}if(i=!!i&&this.chekDate(a),!i)return!1;var l=this.pickData();this.send(l),this.beforeHide("save")},a.prototype.chekDate=function(t){var a=e.Lib.Validator.checkFinishDate(t);return this.inputs.date.classList.add(a.className),this.inputs.time.classList.add(a.className),a.valid},a.prototype.pickData=function(){var e=this.inputs.date.value+" "+this.inputs.time.value,t={id:this.inputs.id?this.inputs.id.value:null,name:this.inputs.name.value,email:this.inputs.email.value,date:new Date(e),birth:new Date(this.inputs.birth.value),avatar:this.avatar,timePassed:!1};return t},a.prototype.send=function(e){var t=this,a=this.container.model.user;a.create(e).then(function(e){t.container.template.userTableTbody.createRow(e)})},a.prototype.beforeHide=function(e){for(var t in this.inputs){var a=this.inputs[t];if(a.classList.remove("error"),a.classList.remove("success"),a.value="","avatar"==t){var i=a.parentNode,n=i.querySelector("img");n&&i.removeChild(n)}}this.hide()},a.prototype.hide=function(){this.modalEl.el.style.visibility="hidden",this.el.classList.toggle("show",!1),this.isShow=!1},a.prototype.show=function(e){e&&this.loadData(e),this.el.classList.toggle("show",!0),this.modalEl.el.style.visibility="visible",this.isShow=!0},a.prototype.render=function(){for(var e=this.renderOrder,a=t.createDocumentFragment(),i=0;i<e.length;i++){var n=e[i];a.appendChild(this.fields[n]())}return this.el.appendChild(a),this.el},e.View.Modal.CreateUser=a}(App,document);